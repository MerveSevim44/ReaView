<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>BiblioNet AkÄ±ÅŸ</title>
  <link rel="stylesheet" href="css/feed.css">
  <style>
    body { font-family: sans-serif; margin: 30px; }
    h1 { color: #2a5; }
    .card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .card small {
      color: #777;
    }
  </style>
</head>
<body>
  <h1>ðŸ“š ReaView AkÄ±ÅŸ</h1>
  <div id="feed-container">YÃ¼kleniyor...</div>

  <script type="module">
    const API_URL = "http://127.0.0.1:8000";

    // Map activity types to Turkish descriptions
    const activityDescriptions = {
      "review": "yorum yaptÄ±",
      "rating": "puan verdi",
      "list_add": "bir iÃ§eriÄŸi listesine ekledi",
      "follow": "kullanÄ±cÄ±yÄ± takip etti",
      "comment": "yorum yaptÄ±"
    };

    async function loadFeed() {
      const container = document.getElementById("feed-container");
      try {
        // Use /detailed endpoint to get username and title along with activity
        const res = await fetch(`${API_URL}/feed/detailed`);
        if (!res.ok) throw new Error(`Sunucu hatasÄ±: ${res.status}`);
        const data = await res.json();

        if (!data || data.length === 0) {
          container.innerHTML = "<p>HenÃ¼z aktivite yok ðŸ“­</p>";
          return;
        }

        // Render activities as cards with full details
        container.innerHTML = data.map(activity => `
          <div class="card">
            <b>${activity.username || "KullanÄ±cÄ±"}</b>
            ${activityDescriptions[activity.activity_type] || "bir iÅŸlem yaptÄ±"}
            <br>
            <em>${activity.title || "â€”"}</em>
            <br>
            <small>${new Date(activity.created_at).toLocaleString("tr-TR")}</small>
          </div>
        `).join("");
      } catch (err) {
        container.innerHTML = `<p style="color:red">Hata: ${err.message}</p>`;
        console.error("Feed yÃ¼kleme hatasÄ±:", err);
      }
    }

    // Load feed when page opens
    loadFeed();
    
    // Optional: Auto-refresh every 10 seconds
    // setInterval(loadFeed, 10000);
  </script>
</body>
</html>
